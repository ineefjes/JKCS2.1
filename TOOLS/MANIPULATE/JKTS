#!/bin/bash

source ~/.JKCSusersetup.txt
scriptpath="$( cd "$(dirname "$0")" ; pwd -P )"
toolspath="$scriptpath/../"

# Default values
SLURM_TIME="128:00:00"
SLURM_PARTITION="qany"
PYTHON_ARGS=()

# Process all arguments
for arg in "$@"; do
  PYTHON_ARGS+=("$arg")
done

# Run the Python script with the correct arguments
if [[ " ${PYTHON_ARGS[*]} " == *" -hh "* ]] || [[ " ${PYTHON_ARGS[*]} " == *" --help "* ]]; then
  program_PYTHON "$toolspath/SCRIPTS/DATS.py" "${PYTHON_ARGS[@]}"
elif [[ " ${PYTHON_ARGS[*]} " == *" -auto "* ]]; then 
  SLURM_SCRIPT=$(mktemp /tmp/slurm-script.XXXXXX)

  cat > $SLURM_SCRIPT <<EOF
#!/bin/sh
#SBATCH --job-name=JKTS
#SBATCH --output=output.log
#SBATCH --error=error.log
#SBATCH --time=$SLURM_TIME
#SBATCH --partition=$SLURM_PARTITION
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem=1500

source ~/.JKCSusersetup.txt
program_PYTHON "$toolspath/SCRIPTS/DATS.py" "${PYTHON_ARGS[@]}"
EOF

  sbatch $SLURM_SCRIPT
  rm $SLURM_SCRIPT
else
  program_PYTHON "$toolspath/SCRIPTS/DATS.py" "${PYTHON_ARGS[@]}"
fi

